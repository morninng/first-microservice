go get -u gorm.io/gorm
go get -u gorm.io/driver/mysql
go get -u  github.com/uptrace/opentelemetry-go-extra/otelgorm



go get github.com/morninng/first-proto/golang/order@v1.2.7
go get github.com/morninng/first-proto/golang/payment@v0.0.1
 
go mod init github.com/morninng/first-microservice/payment


docker run -p 3306:3306 \
-e MYSQL_ROOT_PASSWORD=verysecretpass \
-e MYSQL_DATABASE=order mysql

mysql -h 127.0.0.1 -P 3306 -u root -p
SHOW DATABASES;

それぞれのserviceがConnectするDatabaseがないので初めに作成
CREATE DATABASE payments;



[launch order service]
DATA_SOURCE_URL=root:verysecretpass@tcp(127.0.0.1:3306)/order \
APPLICATION_PORT=3000 \
ENV=development \
PAYMENT_SERVICE_URL=localhost:3001 \
go run cmd/main.go



[launch payment service]
DATA_SOURCE_URL=root:verysecretpass@tcp(127.0.0.1:3306)/payments \
APPLICATION_PORT=3001 \
ENV=development \
go run cmd/main.go


grpcurl -d '{"user_id":123, "order_items":[{"product_code":"prod", "quantity":4, "unit_price":12}]}' -plaintext localhost:3000 Order.Create


go build -o ./build/order ./cmd/main.go

